# Web界面使用指南

## 🎯 系统概述

家庭情绪管理系统Web界面为管理员和家庭成员提供了完整的Web访问能力,支持家庭管理、打卡管理、情绪分析等功能。

## 🚀 快速开始

### 1. 启动系统

```bash
# 激活虚拟环境
source venv/bin/activate  # Linux/Mac
# 或
venv\Scripts\activate  # Windows

# 运行数据库迁移
python manage.py migrate

# 创建超级管理员
python manage.py createsuperuser

# 启动开发服务器
python manage.py runserver
```

### 2. 访问系统

打开浏览器访问: http://127.0.0.1:8000/

## 👥 用户角色

### 1. 超级管理员 (Super Admin)
- 访问Django Admin后台
- 管理所有家庭和用户
- 系统配置和维护

**访问入口**: http://127.0.0.1:8000/admin/

### 2. 家庭管理员 (Family Admin)
- 管理家庭成员
- 创建和管理打卡任务
- 查看所有成员的打卡和情绪记录
- 生成邀请码
- 查看统计报表

**访问入口**: http://127.0.0.1:8000/families/dashboard/

### 3. 家庭成员 (Family Member)
- 查看自己的打卡任务
- 查看自己的情绪记录
- 查看情绪趋势

**访问入口**: http://127.0.0.1:8000/checkins/tasks/

## 📋 功能模块

### 🏠 家庭管理模块

#### 1. 家庭仪表板 (`/families/dashboard/`)
- 显示家庭统计数据
- 最近打卡记录
- 情绪统计概览
- 快捷操作入口

**功能**:
- 查看家庭成员数量
- 查看最近7天打卡统计
- 查看准时率
- 查看活跃任务数
- 查看TOP5情绪分布

#### 2. 邀请码管理 (`/families/invites/`)
- 查看所有邀请码
- 邀请码状态(有效/已使用/已过期)
- 复制邀请码功能

**创建邀请码** (`/families/invites/generate/`):
- 设置用户名(必填)
- 设置显示名称(可选)
- 设置有效期(1-30天)

#### 3. 成员管理 (`/families/members/`)
- 查看所有家庭成员
- 显示成员基本信息
- 显示打卡次数和最近情绪

**成员详情** (`/families/members/<id>/`):
- 查看成员个人资料
- 查看最近30天打卡记录
- 查看最近20条情绪记录
- 统计准时率

### ✅ 打卡管理模块

#### 1. 任务列表 (`/checkins/tasks/`)
- 显示所有打卡任务
- 任务状态(进行中/已停用)
- 总打卡数和今日打卡数

**创建任务** (`/checkins/tasks/create/`):
- 设置任务名称
- 选择任务类型(每日/每周/自定义)
- 设置计划时间
- 选择目标成员

#### 2. 任务详情 (`/checkins/tasks/<id>/`)
- 查看任务基本信息
- 查看统计数据
- 查看最近50条打卡记录

**编辑任务** (`/checkins/tasks/<id>/edit/`):
- 修改任务名称
- 修改任务类型
- 启用/停用任务
- 修改目标成员

#### 3. 打卡记录 (`/checkins/records/`)
- 查看所有打卡记录
- 显示成员、任务、时间、状态、情绪
- 支持查看详情

**打卡详情** (`/checkins/records/<id>/`):
- 查看完整打卡信息
- 查看人脸照片
- 查看情绪分析结果
- 查看位置信息

### 😊 情绪管理模块

#### 1. 情绪记录 (`/emotions/records/`)
- 查看所有情绪记录
- 支持筛选(时间/情绪/成员)
- 卡片式展示

**筛选选项**:
- 时间范围: 7天/14天/30天/90天
- 情绪类型: 开心/难过/生气/恐惧/惊讶/厌恶/平静
- 家庭成员: 全部/指定成员(管理员可见)

#### 2. 情绪详情 (`/emotions/records/<id>/`)
- 查看表情照片
- 查看情绪分析详情
- 查看置信度
- 查看关联的打卡记录

#### 3. 情绪统计 (`/emotions/statistics/`)
- 情绪分布饼图
- 情绪统计详情
- 每日情绪趋势图
- 成员情绪统计表(管理员)

**支持时间范围**:
- 最近7天
- 最近14天
- 最近30天
- 最近90天

#### 4. 情绪趋势 (`/emotions/trends/`)
- 查看指定成员的情绪趋势
- 每日主导情绪
- 每日情绪分布
- 消极情绪占比
- 异常情绪提醒

**异常判断标准**:
- 消极情绪(生气/难过/恐惧/厌恶)占比 > 50%

## 🎨 界面特性

### 响应式设计
- 支持桌面、平板、手机访问
- Bootstrap 5框架
- 自适应布局

### 数据可视化
- Chart.js图表库
- 饼图、折线图
- 实时数据展示

### 交互功能
- 消息提示
- 表单验证
- 确认对话框
- 复制到剪贴板
- 下拉筛选

### 权限控制
- 角色权限区分
- 数据访问控制
- 操作权限验证

## 🔐 安全特性

1. **登录认证**: 所有页面需要登录
2. **权限验证**: 基于角色的访问控制
3. **CSRF保护**: 表单提交保护
4. **数据隔离**: 用户只能访问自己家庭的数据

## 📱 浏览器支持

- Chrome (推荐)
- Firefox
- Safari
- Edge

## ⚠️ 注意事项

1. **首次使用**:
   - 超级管理员需要先在Admin后台创建家庭
   - 家庭管理员需要生成邀请码
   - 新成员使用邀请码注册

2. **人脸注册**:
   - 新用户注册后需要先注册人脸
   - 人脸注册成功后才能使用打卡功能

3. **打卡任务**:
   - 任务需要设置计划时间
   - 超过计划时间打卡标记为"迟到"
   - 停用的任务无法打卡

4. **情绪识别**:
   - 需要AI模型支持
   - 打卡时自动识别情绪
   - 异常情绪会触发邮件通知

5. **数据统计**:
   - 统计数据实时计算
   - 支持多种时间范围
   - 图表数据动态加载

## 🛠️ 故障排除

### 页面404错误
```bash
# 检查URL配置
python manage.py show_urls

# 确保已包含模块的urls.py
```

### 静态文件无法加载
```bash
# 收集静态文件
python manage.py collectstatic

# 检查STATIC_URL配置
```

### 模板未找到
```bash
# 检查TEMPLATES配置
# 确保templates目录在DIRS中

# 检查模板文件路径
find templates -name "*.html"
```

### 图表不显示
- 检查网络连接(CDN)
- 检查浏览器控制台错误
- 确保Chart.js已加载

## 📞 技术支持

如遇到问题,请检查:
1. Django日志
2. 浏览器控制台
3. 数据库连接
4. 模板路径
5. 静态文件配置

## 🔄 更新日志

**v1.0.0 (2026-01-10)**
- ✅ 完成所有Web模板开发
- ✅ 实现17个HTML页面
- ✅ 集成Bootstrap 5和Chart.js
- ✅ 实现权限控制
- ✅ 添加数据可视化
- ✅ 优化用户体验