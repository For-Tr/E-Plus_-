{% extends 'base/base.html' %}
{% load static %}

{% block title %}æƒ…ç»ªè®°å½• - å®¶åº­æƒ…ç»ªç®¡ç†ç³»ç»Ÿ{% endblock %}

{% block content %}
<div class="row">
    <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h2>æƒ…ç»ªè®°å½•</h2>
            <div>
                <a href="{% url 'emotions:statistics' %}" class="btn btn-outline-info">ç»Ÿè®¡åˆ†æ</a>
                <a href="{% url 'emotions:trends' %}" class="btn btn-outline-primary">æƒ…ç»ªè¶‹åŠ¿</a>
            </div>
        </div>
    </div>
</div>

<!-- ç­›é€‰æ¡ä»¶ -->
<div class="row mb-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <form method="get" class="row g-3">
                    <div class="col-md-3">
                        <label for="days" class="form-label">æ—¶é—´èŒƒå›´</label>
                        <select class="form-select" id="days" name="days">
                            <option value="7" {% if days_filter == '7' %}selected{% endif %}>æœ€è¿‘7å¤©</option>
                            <option value="14" {% if days_filter == '14' %}selected{% endif %}>æœ€è¿‘14å¤©</option>
                            <option value="30" {% if days_filter == '30' %}selected{% endif %}>æœ€è¿‘30å¤©</option>
                            <option value="90" {% if days_filter == '90' %}selected{% endif %}>æœ€è¿‘90å¤©</option>
                        </select>
                    </div>
                    
                    <div class="col-md-3">
                        <label for="emotion" class="form-label">æƒ…ç»ªç±»å‹</label>
                        <select class="form-select" id="emotion" name="emotion">
                            <option value="">å…¨éƒ¨</option>
                            <option value="happy" {% if emotion_filter == 'happy' %}selected{% endif %}>ğŸ˜Š å¼€å¿ƒ</option>
                            <option value="sad" {% if emotion_filter == 'sad' %}selected{% endif %}>ğŸ˜¢ éš¾è¿‡</option>
                            <option value="angry" {% if emotion_filter == 'angry' %}selected{% endif %}>ğŸ˜  ç”Ÿæ°”</option>
                            <option value="fear" {% if emotion_filter == 'fear' %}selected{% endif %}>ğŸ˜¨ ææƒ§</option>
                            <option value="surprise" {% if emotion_filter == 'surprise' %}selected{% endif %}>ğŸ˜² æƒŠè®¶</option>
                            <option value="disgust" {% if emotion_filter == 'disgust' %}selected{% endif %}>ğŸ¤¢ åŒæ¶</option>
                            <option value="neutral" {% if emotion_filter == 'neutral' %}selected{% endif %}>ğŸ˜ å¹³é™</option>
                        </select>
                    </div>
                    
                    {% if can_view_all %}
                        <div class="col-md-3">
                            <label for="member" class="form-label">å®¶åº­æˆå‘˜</label>
                            <select class="form-select" id="member" name="member">
                                <option value="">å…¨éƒ¨æˆå‘˜</option>
                                {% for member in members %}
                                    <option value="{{ member.id }}" {% if member_filter == member.id|stringformat:"s" %}selected{% endif %}>
                                        {{ member.display_name|default:member.username }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    {% endif %}
                    
                    <div class="col-md-3 d-flex align-items-end">
                        <button type="submit" class="btn btn-primary w-100">ç­›é€‰</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- è®°å½•åˆ—è¡¨ -->
<div class="row">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                {% if records %}
                    <div class="row">
                        {% for record in records %}
                            <div class="col-md-6 col-lg-4 mb-3">
                                <a href="{% url 'emotions:record_detail' record.id %}" class="text-decoration-none">
                                    <div class="card h-100 hover-shadow">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start mb-2">
                                                <div>
                                                    <h6 class="card-title mb-1">
                                                        {{ record.user.display_name|default:record.user.username }}
                                                    </h6>
                                                    <small class="text-muted">{{ record.recorded_at|date:"mæœˆdæ—¥ H:i" }}</small>
                                                </div>
                                                <span style="font-size: 2rem;">
                                                    {% if record.emotion == 'happy' %}ğŸ˜Š
                                                    {% elif record.emotion == 'sad' %}ğŸ˜¢
                                                    {% elif record.emotion == 'angry' %}ğŸ˜ 
                                                    {% elif record.emotion == 'fear' %}ğŸ˜¨
                                                    {% elif record.emotion == 'surprise' %}ğŸ˜²
                                                    {% elif record.emotion == 'disgust' %}ğŸ¤¢
                                                    {% else %}ğŸ˜
                                                    {% endif %}
                                                </span>
                                            </div>
                                            <p class="mb-2">
                                                <strong>
                                                    {% if record.emotion == 'happy' %}å¼€å¿ƒ
                                                    {% elif record.emotion == 'sad' %}éš¾è¿‡
                                                    {% elif record.emotion == 'angry' %}ç”Ÿæ°”
                                                    {% elif record.emotion == 'fear' %}ææƒ§
                                                    {% elif record.emotion == 'surprise' %}æƒŠè®¶
                                                    {% elif record.emotion == 'disgust' %}åŒæ¶
                                                    {% else %}å¹³é™
                                                    {% endif %}
                                                </strong>
                                            </p>
                                            {% if record.confidence %}
                                                <div class="progress" style="height: 5px;">
                                                    <div class="progress-bar" role="progressbar" 
                                                         style="width: {{ record.confidence }}%"></div>
                                                </div>
                                                <small class="text-muted">ç½®ä¿¡åº¦: {{ record.confidence|floatformat:1 }}%</small>
                                            {% endif %}
                                        </div>
                                    </div>
                                </a>
                            </div>
                        {% endfor %}
                    </div>
                    
                    {% if records|length >= 100 %}
                        <div class="alert alert-info mt-3 mb-0">
                            <i class="bi bi-info-circle"></i> ä»…æ˜¾ç¤ºæœ€è¿‘100æ¡è®°å½•,è¯·ä½¿ç”¨ç­›é€‰åŠŸèƒ½ç¼©å°èŒƒå›´
                        </div>
                    {% endif %}
                {% else %}
                    <div class="text-center py-5">
                        <p class="text-muted mb-3">æ²¡æœ‰æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„æƒ…ç»ªè®°å½•</p>
                        <a href="{% url 'emotions:record_list' %}" class="btn btn-outline-primary">
                            æŸ¥çœ‹å…¨éƒ¨
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.hover-shadow {
    transition: box-shadow 0.3s ease;
}
.hover-shadow:hover {
    box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
}
</style>
{% endblock %}